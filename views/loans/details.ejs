
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Loan Details</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <a href="/loans" class="btn btn-sm btn-outline-secondary">
      <i class="fas fa-arrow-left"></i> Back to Loans
    </a>
  </div>
</div>

<div class="row">
  <div class="col-md-8 mx-auto">
    <div class="card">
      <div class="card-header">
        <h5>Loan Information</h5>
      </div>
      <div class="card-body">
        <table class="table">
          <tr>
            <th>Book:</th>
            <td>
              <%= loan.book.title %> by <%= loan.book.author %>
              <a href="/books/details/<%= loan.book._id %>" class="btn btn-sm btn-link">View Book</a>
            </td>
          </tr>
          <tr>
            <th>Student:</th>
            <td>
              <%= loan.student.name %> (<%= loan.student.studentId %>)
              <a href="/students/details/<%= loan.student._id %>" class="btn btn-sm btn-link">View Student</a>
            </td>
          </tr>
          <tr>
            <th>Issue Date:</th>
            <td><%= moment(loan.issueDate).format('MMMM D, YYYY') %></td>
          </tr>
          <tr>
            <th>Due Date:</th>
            <td><%= moment(loan.dueDate).format('MMMM D, YYYY') %></td>
          </tr>
          <tr>
            <th>Status:</th>
            <td>
              <% if(loan.status === 'issued') { %>
                <% if(new Date() > new Date(loan.dueDate)) { %>
                  <span class="badge bg-danger">Overdue</span>
                <% } else { %>
                  <span class="badge bg-info">Issued</span>
                <% } %>
              <% } else if(loan.status === 'returned') { %>
                <span class="badge bg-success">Returned</span>
              <% } else { %>
                <span class="badge bg-danger">Overdue</span>
              <% } %>
            </td>
          </tr>
          <% if(loan.status === 'returned') { %>
            <tr>
              <th>Return Date:</th>
              <td><%= moment(loan.returnDate).format('MMMM D, YYYY') %></td>
            </tr>
            <tr>
              <th>Fine:</th>
              <td>
                <% if(loan.fine > 0) { %>
                  <span class="text-danger">$<%= loan.fine.toFixed(2) %></span>
                <% } else { %>
                  $0.00
                <% } %>
              </td>
            </tr>
          <% } %>
          <tr>
            <th>Issued By:</th>
            <td><%= loan.issuedBy.name %></td>
          </tr>
        </table>
        
        <div class="mt-3">
          <% if(loan.status !== 'returned') { %>
            <form action="/loans/return/<%= loan._id %>?_method=PUT" method="POST" class="d-inline">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-undo"></i> Return Book
              </button>
            </form>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>